jQuery(document).ready(function($){let api_url="https://api.equiduct.com/mdwebapi";let instrumentMap={};function calculateIncrement(numInicial,numFinal){if(numInicial===0)return numFinal===0?0:Infinity;return parseFloat(((numFinal-numInicial)/numInicial*100).toFixed(2))}
function getTrend(numInicial,numFinal){if(numFinal>numInicial)return'positive';else if(numFinal<numInicial)return'negative';else return'same'}
function format_price_dynamic(price){let decimals=price%1===0?2:Math.min(4,price.toString().split('.')[1]?.length||2);return price.toFixed(decimals)}
function format_slide_html(element){let icon=element.trend==='positive'?'â–²':element.trend==='negative'?'â–¼':'â–¬';return `
        <b>${element.nombre}:</b>
        <span class="price">${format_price_dynamic(element.precioActual)}</span>
        <span class="percent ${element.trend}">${icon} ${element.percent}%</span>
    `}
function build_swipers(arrayMercados){let slider1=arrayMercados.splice((arrayMercados.length/2));let slider2=arrayMercados;slider1.forEach((element)=>{$(".instrument-swiper .swiper-wrapper").append(`<div class="swiper-slide slide-instrument-${element.nombre}">${format_slide_html(element)}</div>`)});slider2.forEach((element)=>{$(".instrument-swiper-reverse .swiper-wrapper").append(`<div class="swiper-slide slide-instrument-${element.nombre}">${format_slide_html(element)}</div>`)});$(".placeholder-swiper-2, .placeholder-swiper").remove();init_swiper(".instrument-swiper",!1,!1);init_swiper(".instrument-swiper-reverse",!0,!0)}
function update_existing_slides(arrayMercados){arrayMercados.forEach((element)=>{let icon=element.trend==='positive'?'â–²':element.trend==='negative'?'â–¼':'â–¬';$(`.slide-instrument-${element.nombre}`).each(function(){$(this).find('.price').text(format_price_dynamic(element.precioActual));$(this).find('.percent').attr('class',`percent ${element.trend}`).text(`${icon} ${element.percent}%`)})})}
function get_market_data(initial=!1){$.ajax({method:"GET",url:`${api_url}/top/instrument/price?n=20`,}).done(function(response){let dataArray;try{dataArray=Array.isArray(response)?response:(typeof response==='string'?JSON.parse(response):response?.data??[])}catch(e){console.error("âŒ Error al parsear respuesta:",e);return}
if(!Array.isArray(dataArray)||dataArray.length===0){console.warn("âš ï¸ No se encontraron instrumentos");return}
const arrayMercados=dataArray.map(item=>{let precioActual=item.close??item.prev_close;return{nombre:item.id,precioActual:precioActual,percent:calculateIncrement(item.prev_close,precioActual),trend:getTrend(item.prev_close,precioActual),currency:"EUR"}});if(initial){build_swipers(arrayMercados)}else{update_existing_slides(arrayMercados)}}).fail(function(error){console.error("âŒ Error al obtener datos:",error)})}
function init_placeholder_carousels(container){new Swiper(container,{loop:!0,allowTouchMove:!1,slidesPerView:12,spaceBetween:20,centeredSlides:!0,autoplay:{delay:0,disableOnInteraction:!1,reverseDirection:!0},speed:10000})}
function init_swiper(container,reverse,centered){new Swiper(container,{loop:!0,allowTouchMove:!1,breakpoints:{500:{slidesPerView:1},600:{slidesPerView:2},800:{slidesPerView:3},1200:{slidesPerView:6}},spaceBetween:40,centeredSlides:centered,autoplay:{delay:0,disableOnInteraction:!1,reverseDirection:reverse},speed:10000,on:{init:function(){setTimeout(()=>{this.autoplay.start()},100)}},})}
init_placeholder_carousels(".placeholder-swiper,.placeholder-swiper-2");get_market_data(!0);setInterval(()=>{console.log("ðŸ”„ Actualizando datos en caliente...");get_market_data(!1)},60000)})
;